import requests
from pprint import pprint
import datetime
import json

key = "56c3de4e-0d41-4af5-9b64-778e17869126"

def get_builtwith_data(lookup):
    """
    lookup: domain name
    """
    final_data = {}
    url = f"https://api.builtwith.com/v21/api.json?KEY={key}&LOOKUP={lookup}"
    response = requests.get(url)
    print(response.status_code)
    if response.status_code == 200:
        data = json.loads(response.json())
        file_name = "response_output_" + lookup + str(datetime.datetime.now()) + ".json"
        with open(file_name, 'w') as file:
            file.write(json.dumps(data))
        
        final_data["SpendHistory"] = data["Result"]["SpendHistory"]
        final_data["Attributes"] = data["Meta"]["Attributes"]
        final_data["FirstIndexed"] = data["Meta"]["FirstIndexed"]
        final_data["LastIndexed"] = data["Meta"]["LastIndexed"]
        final_data["Lookup"] = data["Meta"]["Lookup"]
        final_data["SalesRevenue"] = data["Result"]["SalesRevenue"]
        
        file_name = "corrected_response_output_" + lookup + str(datetime.datetime.now()) + ".json"
        with open(file_name, 'w') as file:
            file.write(json.dumps(final_data))
    
    return json.dumps(final_data)
